<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Polyhydra Vortex Star Puzzle</title>
<style>
body, html {
    margin:0; padding:0;
    width:100%; height:100%;
    overflow:hidden;
    background:#111;
    font-family:'Arial Black', sans-serif;
    touch-action:none;
}
canvas { display:block; }

/* --- Game UI --- */
#ui {
    position:absolute;
    top:20px;
    left:50%;
    transform:translateX(-50%);
    display:flex;
    flex-direction:column;
    align-items:center;
    z-index:10;
    color:#fff;
    max-width: 90%;
}
#status {
    font-size:36px;
    margin-bottom:20px;
    text-align:center;
    color:#0f0;
    text-shadow:2px 2px 10px #000;
}
button {
    font-size:28px;
    padding:12px 30px;
    margin:5px;
    border:none;
    border-radius:15px;
    cursor:pointer;
    background: linear-gradient(#222,#555);
    color:#fff;
    text-shadow:1px 1px 2px #000;
    transition:0.2s;
}
button:hover { background: linear-gradient(#555,#222); }

#leaderboard {
    margin-top:20px;
    font-size:24px;
    color:#ff0;
    text-align:center;
    display:none;
}
input[type="text"]{
    font-size:20px;
    padding:5px 10px;
    border-radius:10px;
    border:none;
    margin-top:10px;
}

/* --- Responsive UI --- */
@media (max-width:600px){
    #status { font-size:24px; }
    button { font-size:18px; padding:8px 20px; }
    #leaderboard { font-size:18px; }
}
@media (min-width:601px) and (max-width:1200px){
    #status { font-size:32px; }
    button { font-size:24px; padding:10px 25px; }
    #leaderboard { font-size:20px; }
}
@media (min-width:1201px){
    #status { font-size:40px; }
    button { font-size:28px; padding:12px 30px; }
    #leaderboard { font-size:24px; }
}
</style>
</head>
<body>
<div id="ui">
    <div id="status">Select Begin Star</div>
    <div>
        <button id="resetBtn">Restart Game</button>
        <button id="toggleLeaderboardBtn">Show Leaderboard</button>
    </div>
    <div id="leaderboard">
        <div>ðŸŒŸ Leaderboard ðŸŒŸ</div>
        <div id="entries">No submissions yet</div>
        <input type="text" id="playerName" placeholder="Your Name"/>
        <button id="submitBtn">Submit Score</button>
    </div>
</div>
<canvas id="canvas"></canvas>
<script>
const canvas=document.getElementById('canvas');
const ctx=canvas.getContext('2d');
canvas.width=window.innerWidth; canvas.height=window.innerHeight;

// ----------------------
// Star Vortex Setup
// ----------------------
let starList=[];
let rotX=0, rotY=0;
const totalStars=10;
const radius=0.5, heightStep=0.3;

// Puzzle state
let beginStar=null;
let endStar=null;
let currentStar=null;
let visited=[];
let moveCount=0;

// Leaderboard (persistent)
let leaderboard=JSON.parse(localStorage.getItem('vortexLeaderboard')) || [];

// Create star vortex
for(let i=0;i<totalStars;i++){
    let angle=i*(Math.PI/4);
    let z=i*heightStep;
    starList.push({
        id:i,
        x: radius*Math.cos(angle),
        y: radius*Math.sin(angle),
        z: z,
        edges:[[0,1],[0,2],[0,3],[1,2],[1,3],[2,3]],
        vertices:[
            [0,0,0.1],
            [0.05,0,-0.05],
            [-0.05,0.05,-0.05],
            [-0.05,-0.05,-0.05]
        ],
        neighbors:[],
        type:i%2===0?"Human":"AI"
    });
}

// Connect stars sequentially
for(let i=0;i<totalStars-1;i++){
    starList[i].neighbors.push(starList[i+1].id);
    starList[i+1].neighbors.push(starList[i].id);
}

// ----------------------
// 3D Projection & Rotation
// ----------------------
function rotateXVec([x,y,z],angle){ const c=Math.cos(angle),s=Math.sin(angle); return [x, y*c - z*s, y*s + z*c]; }
function rotateYVec([x,y,z],angle){ const c=Math.cos(angle),s=Math.sin(angle); return [x*c + z*s, y, -x*s + z*c]; }
function project([x,y,z]){ const scale=500; return [canvas.width/2 + x*scale, canvas.height/2 - y*scale]; }

// Draw star as a tetra-like star shape
function drawStar(s){
    const transformed=s.vertices.map(v=>{
        let vx=v[0]+s.x, vy=v[1]+s.y, vz=v[2]+s.z;
        return rotateYVec(rotateXVec([vx,vy,vz], rotX), rotY);
    });
    let color="#555";
    if(s===beginStar) color="#0f0";
    else if(s===endStar) color="#f0f";
    else if(visited.includes(s.id)) color="#ff0";
    else color=s.type==="Human"?"#0a0":"#00a";

    for(const [i,j] of s.edges){
        const [x1,y1]=project(transformed[i]);
        const [x2,y2]=project(transformed[j]);
        ctx.strokeStyle=color;
        ctx.lineWidth=2;
        ctx.beginPath();
        ctx.moveTo(x1,y1);
        ctx.lineTo(x2,y2);
        ctx.stroke();
    }
    // Draw star symbol
    const [cx,cy]=project([s.x,s.y,s.z]);
    ctx.fillStyle=color;
    ctx.font="24px Arial Black";
    ctx.fillText("â˜…", cx-12, cy+8);
}

// Pick star under pointer
function pickStar(x,y){
    for(const s of starList){
        const [sx,sy]=project(rotateYVec(rotateXVec([s.x,s.y,s.z], rotX), rotY));
        const dx=x-sx, dy=y-sy;
        if(Math.sqrt(dx*dx+dy*dy)<30) return s;
    }
    return null;
}

// Animation loop
function draw(){
    ctx.fillStyle="#111";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    starList.forEach(s=>drawStar(s));
    requestAnimationFrame(draw);
}
draw();

// ----------------------
// Rotation controls
// ----------------------
let isDragging=false, lastX=0, lastY=0;
canvas.addEventListener('mousedown', e=>{ isDragging=true; lastX=e.clientX; lastY=e.clientY; });
canvas.addEventListener('mousemove', e=>{ if(isDragging){ let dx=e.clientX-lastX, dy=e.clientY-lastY; rotY+=dx*0.01; rotX+=dy*0.01; lastX=e.clientX; lastY=e.clientY; }});
canvas.addEventListener('mouseup', e=>isDragging=false);
canvas.addEventListener('mouseleave', e=>isDragging=false);
canvas.addEventListener('touchstart', e=>{ isDragging=true; lastX=e.touches[0].clientX; lastY=e.touches[0].clientY; });
canvas.addEventListener('touchmove', e=>{ e.preventDefault(); if(isDragging){ let dx=e.touches[0].clientX-lastX, dy=e.touches[0].clientY-lastY; rotY+=dx*0.01; rotX+=dy*0.01; lastX=e.touches[0].clientX; lastY=e.touches[0].clientY; } });
canvas.addEventListener('touchend', e=>isDragging=false);

// ----------------------
// Puzzle Click
// ----------------------
canvas.addEventListener('click', e=>{
    const s=pickStar(e.clientX,e.clientY);
    if(!s) return;
    if(!beginStar){
        beginStar=s;
        currentStar=s;
        endStar=starList[starList.length-1];
        visited.push(s.id);
        moveCount=0;
        document.getElementById('status').innerText="Navigate to Magenta End!";
    } else if(currentStar.neighbors.includes(s.id) && !visited.includes(s.id)){
        currentStar=s;
        visited.push(s.id);
        moveCount++;
        if(currentStar===endStar){
            document.getElementById('status').innerText=`ðŸŽ‰ Puzzle Complete in ${moveCount} moves! Enter Name to Submit`;
        }
    }
});

// ----------------------
// Reset
// ----------------------
function resetPuzzle(){
    beginStar=null;
    endStar=null;
    currentStar=null;
    visited=[];
    moveCount=0;
    document.getElementById('status').innerText="Select Begin Star";
}

// ----------------------
// Leaderboard
// ----------------------
function updateLeaderboardUI(){
    const entries=document.getElementById('entries');
    entries.innerHTML=leaderboard.slice(0,5).map((e,i)=>`${i+1}. ${e.name} - ${e.moves} moves`).join('<br>') || "No submissions yet";
}
updateLeaderboardUI();

document.getElementById('submitBtn').addEventListener('click', ()=>{
    const name=document.getElementById('playerName').value || "Anonymous";
    if(currentStar!==endStar) return;
    leaderboard.push({name:name,moves:moveCount});
    leaderboard.sort((a,b)=>a.moves-b.moves);
    localStorage.setItem('vortexLeaderboard', JSON.stringify(leaderboard));
    updateLeaderboardUI();
    document.getElementById('playerName').value="";
});

document.getElementById('resetBtn').addEventListener('click', resetPuzzle);

// ----------------------
// Toggle Leaderboard
// ----------------------
const lbDiv=document.getElementById('leaderboard');
let lbVisible=false;
document.getElementById('toggleLeaderboardBtn').addEventListener('click', ()=>{
    lbVisible=!lbVisible;
    lbDiv.style.display=lbVisible ? "flex" : "none";
    document.getElementById('toggleLeaderboardBtn').innerText=lbVisible ? "Hide Leaderboard" : "Show Leaderboard";
});

// Responsive canvas
window.addEventListener('resize', ()=>{canvas.width=window.innerWidth; canvas.height=window.innerHeight;});
</script>
</body>
</html>
